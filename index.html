<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>System Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 80%; margin: auto; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        canvas { width: 80%; max-width: 600px; margin: 20px auto; }
    </style>
    <script>
        let timeLabels = [], temperatureData = [], cpuLoadData = [];
        let temperatureChart, cpuLoadChart;

        function fetchData() {
            fetch("get_data.php")
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    updateCharts(data[0]); // C·∫≠p nh·∫≠t bi·ªÉu ƒë·ªì v·ªõi d·ªØ li·ªáu m·ªõi nh·∫•t
                    updateTable(data); // C·∫≠p nh·∫≠t b·∫£ng v·ªõi d·ªØ li·ªáu ƒë·∫ßy ƒë·ªß
                }
            })
            .catch(error => console.error("L·ªói:", error));
        }

        function updateCharts(latestData) {
            let currentTime = new Date().toLocaleTimeString();

            if (timeLabels.length >= 20) {
                timeLabels.shift();
                temperatureData.shift();
                cpuLoadData.shift();
            }
            timeLabels.push(currentTime);
            temperatureData.push(latestData.temperature);
            cpuLoadData.push(latestData.cpu_load);

            temperatureChart.data.labels = timeLabels;
            temperatureChart.data.datasets[0].data = temperatureData;
            temperatureChart.update();

            cpuLoadChart.data.labels = timeLabels;
            cpuLoadChart.data.datasets[0].data = cpuLoadData;
            cpuLoadChart.update();
        }

        function updateTable(data) {
            let tableBody = document.getElementById("data-table-body");
            tableBody.innerHTML = ""; // X√≥a d·ªØ li·ªáu c≈©

            data.forEach(row => {
                let tr = `<tr>
                    <td>${row.id}</td>
                    <td>${row.temperature} ¬∞C</td>
                    <td>${row.fan_speed} RPM</td>
                    <td>${row.ram_used} MB</td>
                    <td>${row.ram_free} MB</td>
                    <td>${row.disk_used} GB</td>
                    <td>${row.disk_free} GB</td>
                    <td>${row.cpu_load} %</td>
                    <td>${row.ip_address}</td>
                    <td>${row.uptime}</td>
                    <td>${row.os_info}</td>
                    <td>${row.received_at}</td>
                </tr>`;
                tableBody.innerHTML += tr;
            });
        }

        window.onload = function() {
            const ctx1 = document.getElementById("temperatureChart").getContext("2d");
            temperatureChart = new Chart(ctx1, {
                type: "line",
                data: { labels: timeLabels, datasets: [{ label: "Temperature (¬∞C)", borderColor: "red", fill: false, data: temperatureData }] },
                options: { responsive: true }
            });

            const ctx2 = document.getElementById("cpuLoadChart").getContext("2d");
            cpuLoadChart = new Chart(ctx2, {
                type: "line",
                data: { labels: timeLabels, datasets: [{ label: "CPU Load (%)", borderColor: "blue", fill: false, data: cpuLoadData }] },
                options: { responsive: true }
            });

            setInterval(fetchData, 2000); // C·∫≠p nh·∫≠t m·ªói 2 gi√¢y
        };
    </script>
</head>
<body>
    <h2>üìä H·ªá th·ªëng gi√°m s√°t th·ªùi gian th·ª±c</h2>

    <canvas id="temperatureChart"></canvas>
    <canvas id="cpuLoadChart"></canvas>

    <h3>üìã D·ªØ li·ªáu chi ti·∫øt</h3>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nhi·ªát ƒë·ªô</th>
                <th>T·ªëc ƒë·ªô qu·∫°t</th>
                <th>RAM ƒë√£ d√πng</th>
                <th>RAM c√≤n tr·ªëng</th>
                <th>·ªî c·ª©ng ƒë√£ d√πng</th>
                <th>·ªî c·ª©ng c√≤n tr·ªëng</th>
                <th>T·∫£i CPU</th>
                <th>IP</th>
                <th>Th·ªùi gian ho·∫°t ƒë·ªông</th>
                <th>H·ªá ƒëi·ªÅu h√†nh</th>
                <th>Th·ªùi gian nh·∫≠n</th>
            </tr>
        </thead>
        <tbody id="data-table-body"></tbody>
    </table>
</body>
</html>

